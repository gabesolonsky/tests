<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>College Teams Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet" />
</head>
<body class="bg-gray-100 antialiased text-gray-900">
  <div class="flex h-screen overflow-hidden sidebar-expanded" id="app">
    <aside id="sidebar" class="sidebar w-64 bg-white shadow-md flex flex-col transition-all duration-300">
      <div class="flex items-center justify-between px-4 py-4 border-b border-gray-200">
        <div class="flex items-center space-x-2">
          <img src="https://ussquash.org/wp-content/uploads/2021/10/Vertical-01-696x665.jpg" alt="Logo" class="w-6 h-6 object-contain shrink-0" />
          <span class="text-xl font-semibold sidebar-text">US Squash</span>
        </div>
        <button onclick="toggleSidebar()" class="toggle-btn p-1 hover:bg-gray-100 rounded-md transition-all">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
      </div>
      <nav class="flex-1 overflow-y-auto mt-4 px-2 text-sm font-medium space-y-6">

        <div>
            <p class="text-gray-500 uppercase sidebar-text">Profile</p>
            <ul class="mt-2 space-y-1">
                <li><a href="dashboard" id="dashboard-link" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="layout-dashboard" class="w-5 h-5"></i><span class="sidebar-text">Dashboard</span></a></li>
                <li><a href="analytics" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="bar-chart" class="w-5 h-5"></i><span class="sidebar-text">Analytics</span></a></li>
                <li><a href="playertracker" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="user-round-search" class="w-5 h-5"></i><span class="sidebar-text">Advanced Player Tracker</span></a></li>
            </ul>
        </div>

        <div>
            <p class="text-gray-500 uppercase sidebar-text">Players</p>
            <ul class="mt-2 space-y-1">
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="calendar" class="w-5 h-5"></i><span class="sidebar-text">Events</span></a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="trending-up" class="w-5 h-5"></i><span class="sidebar-text">Rankings</span></a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="columns-3" class="w-5 h-5"></i><span class="sidebar-text">Leagues</span></a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="house" class="w-5 h-5"></i><span class="sidebar-text">Clubs</span></a></li>
            </ul>
        </div>

        <div>
            <p class="text-gray-500 uppercase sidebar-text">College Squash Association</p>
            <ul class="mt-2 space-y-1">
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="university" class="w-5 h-5"></i><span class="sidebar-text">Home</span></a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-purple-600"><i data-lucide="university" class="w-5 h-5"></i><span class="sidebar-text">Teams</span></a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="calendar-1" class="w-5 h-5"></i><span class="sidebar-text">Schedule</span></a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="trending-up" class="w-5 h-5"></i><span class="sidebar-text">Standings</span></a></li>
            </ul>
        </div>

        <div>
            <p class="text-gray-500 uppercase sidebar-text">Other</p>
            <ul class="mt-2 space-y-1">
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="life-buoy" class="w-5 h-5"></i><span class="sidebar-text">Help</span></a></li>
                <li><a href="#" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="settings" class="w-5 h-5"></i><span class="sidebar-text">Settings</span></a></li>
            </ul>
        </div>

        <div>
            <p class="text-gray-500 uppercase sidebar-text mt-6">Contact</p>
            <ul class="mt-2 space-y-1">
                <li><a href="tel:301-347-8710" class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700">
                    <i data-lucide="phone" class="w-5 h-5"></i><span class="sidebar-text">Contact Us: 301-347-8710</span>
                </a></li>
            </ul>
        </div>
      </nav>
    </aside>

    <main class="flex-1 overflow-y-auto p-6">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h1 id="welcome-message" class="text-2xl font-semibold tracking-tight">College Teams Overview</h1>
          <p class="text-sm text-gray-500">Explore team performance and analytics.</p>
        </div>
        <div class="relative">
          <input
            type="text"
            placeholder="Search teams..."
            class="pl-10 pr-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm shadow-sm"
          />
          <svg
            class="absolute left-3 top-2.5 w-4 h-4 text-gray-400"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z" />
          </svg>
        </div>
      </div>

      <section id="college-analytics" class="college-tab-content hidden">
        <div class="bg-white/70 backdrop-blur-md border border-gray-200 rounded-2xl p-6 shadow-xl font-sans">
          <h2 class="text-xl font-semibold mb-4 text-gray-800">College Teams Analytics</h2>
          <p class="text-gray-700">This section will provide in-depth analytical charts and data for college teams.</p>
          <div class="grid grid-cols-1 gap-6 mt-6">
            <div class="bg-purple-50 p-4 rounded-lg shadow-sm">
                <h3 class="font-semibold text-lg text-purple-800">Team Performance Trends</h3>
                <div id="team-performance-chart" class="h-64">
                    <p class="text-center text-gray-500 mt-10">Loading team performance chart...</p>
                </div>
            </div>
            <div class="bg-red-50 p-4 rounded-lg shadow-sm">
                <h3 class="font-semibold text-lg text-red-800">Player Contribution Breakdown</h3>
                <p class="text-red-700">Detailed statistics on individual player impact within teams.</p>
            </div>
          </div>
        </div>
      </section>

        <div class="bg-white/70 backdrop-blur-md border border-gray-200 rounded-2xl p-6 shadow-xl font-sans">
          <h2 class="text-xl font-semibold mb-4 text-gray-800">All College Teams</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div id="mens-varsity-container" class="bg-blue-50 p-4 rounded-lg shadow-sm">
                <h3 class="font-semibold text-lg text-blue-800 mb-4">Men's Varsity Teams</h3>
                <div id="mens-varsity-content" class="grid grid-cols-1 gap-4">
                    <p class="text-center text-gray-500 mt-10">Loading men's varsity teams data...</p>
                </div>
            </div>

            <div id="womens-varsity-container" class="bg-blue-50 p-4 rounded-lg shadow-sm">
                <h3 class="font-semibold text-lg text-blue-800 mb-4">Women's Varsity Teams</h3>
                <div id="womens-varsity-content" class="grid grid-cols-1 gap-4">
                    <p class="text-center text-gray-500 mt-10">Loading women's varsity teams data...</p>
                </div>
            </div>

            <div id="womens-club-container" class="bg-blue-50 p-4 rounded-lg shadow-sm">
                <h3 class="font-semibold text-lg text-blue-800 mb-4">Women's Club Teams</h3>
                <div id="womens-club-content" class="grid grid-cols-1 gap-4">
                    <p class="text-center text-gray-500 mt-10">Loading women's club teams data...</p>
                </div>
            </div>

            <div id="mixed-club-container" class="bg-blue-50 p-4 rounded-lg shadow-sm">
                <h3 class="font-semibold text-lg text-blue-800 mb-4">Mixed Club Teams</h3>
                <div id="mixed-club-content" class="grid grid-cols-1 gap-4">
                    <p class="text-center text-gray-500 mt-10">Loading mixed club teams data...</p>
                </div>
            </div>
          </div>
        </div>
      
    </main>
  </div>

<script>
    // Toggles the sidebar visibility
    function toggleSidebar() {
        document.getElementById("app").classList.toggle("sidebar-collapsed");
    }

  // Tab switching logic for college teams page
  function showCollegeTab(tabId) {
    // Hide all tab content sections
    document.querySelectorAll(".college-tab-content").forEach((tab) => {
      tab.classList.add("hidden");
    });
    // Show the selected tab content section
    document.getElementById(tabId).classList.remove("hidden");

    // Update active link styling in sidebar
    document.querySelectorAll(".college-nav-link").forEach((link) => {
      link.classList.remove("text-purple-600");
      link.classList.add("text-gray-700");
    });
    // Add active styling to the clicked link
    const activeLink = document.querySelector(`[onclick="showCollegeTab('${tabId}')"]`);
    if (activeLink) {
        activeLink.classList.remove("text-gray-700");
        activeLink.classList.add("text-purple-600");
    }
  }

  // Function to fetch and display teams
  async function fetchAndDisplayTeams() {
      const apiUrl = "https://api.ussquash.com/resources/leagues/info/2200";

      try {
          const response = await fetch(apiUrl);
          if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
          }
          const teamsData = await response.json();

          const mensVarsity = teamsData.filter(team => team.LeagueDescr === "CSA Men's Varsity");
          const womensVarsity = teamsData.filter(team => team.LeagueDescr === "CSA Women's Varsity");
          const womensClub = teamsData.filter(team => team.LeagueDescr === "CSA Women's Club Teams");
          const mixedClub = teamsData.filter(team => team.LeagueDescr === "CSA Mixed Club Teams");

          function renderTeams(containerId, teams) {
              const container = document.getElementById(containerId);
              container.innerHTML = ''; // Clear loading message
              if (teams.length === 0) {
                  container.innerHTML = '<p class="text-gray-500 col-span-full">No teams found for this category.</p>';
                  return;
              }
              teams.forEach(team => {
                  const teamCard = `
                      <div class="bg-white p-4 rounded-lg shadow-sm">
                          <h4 class="font-semibold text-md text-gray-800">${team.LeagueDescr}</h4>
                          <p class="text-gray-700">Number of Teams: ${team.NumTeams}</p>
                          <p class="text-gray-700">Season: ${team.SeasonDescr}</p>
                          ${team.LogoImageUrl ? `<img src="${team.LogoImageUrl}" alt="${team.LeagueDescr} logo" class="mt-2 w-12 h-12 object-contain">` : ''}
                      </div>
                  `;
                  container.insertAdjacentHTML('beforeend', teamCard);
              });
          }

          renderTeams('mens-varsity-content', mensVarsity);
          renderTeams('womens-varsity-content', womensVarsity);
          renderTeams('womens-club-content', womensClub);
          renderTeams('mixed-club-content', mixedClub);

      } catch (error) {
          console.error("Error fetching or parsing team data:", error);
          document.getElementById('mens-varsity-content').innerHTML = '<p class="text-red-500 col-span-full">Failed to load data for Men\'s Varsity.</p>';
          document.getElementById('womens-varsity-content').innerHTML = '<p class="text-red-500 col-span-full">Failed to load data for Women\'s Varsity.</p>';
          document.getElementById('womens-club-content').innerHTML = '<p class="text-red-500 col-span-full">Failed to load data for Women\'s Club.</p>';
          document.getElementById('mixed-club-content').innerHTML = '<p class="text-red-500 col-span-full">Failed to load data for Mixed Club Teams.</p>';
      }
  }

  // Set initial tab on page load and fetch data
  document.addEventListener("DOMContentLoaded", () => {
    showCollegeTab("college-dashboard"); // Default to showing the dashboard tab
    fetchAndDisplayTeams(); // Fetch team data for all sections

    // Example ApexCharts for Analytics Tab (you'll replace this with real data)
    const chartOptions = {
        series: [{
            name: 'Wins',
            data: [44, 55, 57, 56, 61, 58, 63, 60, 66]
        }, {
            name: 'Losses',
            data: [76, 85, 101, 98, 87, 105, 91, 114, 94]
        }],
        chart: {
            type: 'bar',
            height: 250,
            toolbar: {
                show: false
            }
        },
        plotOptions: {
            bar: {
                horizontal: false,
                columnWidth: '55%',
                endingShape: 'rounded'
            },
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            show: true,
            width: 2,
            colors: ['transparent']
        },
        xaxis: {
            categories: ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'],
        },
        yaxis: {
            title: {
                text: 'Number of Matches'
            }
        },
        fill: {
            opacity: 1
        },
        tooltip: {
            y: {
                formatter: function (val) {
                    return val + " matches"
                }
            }
        },
        colors: ['#4CAF50', '#F44336'] // Green for wins, Red for losses
    };

    const chartElement = document.querySelector('#team-performance-chart');
    if (chartElement) {
        // Clear placeholder text before rendering chart
        chartElement.innerHTML = ''; 
        const chart = new ApexCharts(chartElement, chartOptions);
        chart.render();
    }
  });

  lucide.createIcons();
</script>
</body>
</html>